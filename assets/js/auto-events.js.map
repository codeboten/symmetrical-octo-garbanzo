{"version":3,"file":"auto-events.source.js","sources":["auto-events.source.js"],"sourcesContent":["(function saAutomatedEvents(window) {\n  // Skip server side rendered pages\n  if (typeof window === \"undefined\") return;\n\n  var log = function (message, type) {\n    var logger = type === \"warn\" ? console.warn : console.info;\n    return logger && logger(\"Simple Analytics auto events:\", message);\n  };\n\n  var doc = window.document;\n\n  var scriptElement =\n    doc.currentScript || doc.querySelector('script[src*=\"auto-events.js\"]');\n\n  var setting = function (attribute, type, defaultValue) {\n    var value = scriptElement && scriptElement.dataset[attribute];\n\n    // Booleans\n    if (type === \"bool\" && (value === \"true\" || value === \"false\"))\n      return value === \"true\";\n    else if (type === \"bool\") return defaultValue;\n\n    // Arrays\n    if (type === \"array\" && value)\n      return value\n        .split(\",\")\n        .map(function (item) {\n          return item.trim();\n        })\n        .filter(Boolean);\n    else if (type === \"array\") return defaultValue;\n\n    return value || defaultValue;\n  };\n\n  var collectTypes = setting(\"collect\", \"array\", [\n    \"outbound\",\n    \"emails\",\n    \"downloads\",\n  ]);\n  var fullUrls = setting(\"fullUrls\", \"bool\", false);\n\n  var options = {\n    // What to collect\n    outbound: collectTypes.indexOf(\"outbound\") > -1,\n    emails: collectTypes.indexOf(\"emails\") > -1,\n    downloads: collectTypes.indexOf(\"downloads\") > -1,\n    // Downloads: enter file extensions you want to collect\n    downloadsExtensions: setting(\"extensions\", \"array\", [\n      \"pdf\",\n      \"csv\",\n      \"docx\",\n      \"xlsx\",\n      \"zip\",\n      \"doc\",\n      \"xls\",\n    ]),\n\n    // All: use title attribute if set for event name (for all events)\n    // THIS TAKES PRECEDENCE OVER OTHER SETTINGS BELOW\n    title: setting(\"useTitle\", \"bool\", true),\n    // Outbound: use full URL of the links? false for just the hostname\n    outboundFullUrl: fullUrls,\n    // Downloads: if taking event name from URL, use full URL or just filename (default)\n    downloadsFullUrl: fullUrls,\n  };\n\n  var saGlobal = setting(\"saGlobal\", \"string\", \"sa_event\");\n\n  // For minifying the script\n  var optionsLink = options;\n\n  if (typeof optionsLink === \"undefined\")\n    log(\"options object not found, please specify\", \"warn\");\n\n  window.saAutomatedLink = function saAutomatedLink(element, type) {\n    try {\n      if (!element) return log(\"no element found\");\n      var sent = false;\n\n      var callback = function () {\n        if (!sent && !element.hasAttribute(\"target\"))\n          document.location = element.getAttribute(\"href\");\n        sent = true;\n      };\n\n      if (window[saGlobal] && window[saGlobal + \"_loaded\"]) {\n        var hostname = element.hostname;\n        var pathname = element.pathname;\n        var useTitle = false;\n        if (optionsLink.title && element.hasAttribute(\"title\")) {\n          var theTitle = element.getAttribute(\"title\").trim();\n          if (theTitle != \"\") useTitle = true;\n        }\n\n        var event;\n\n        if (useTitle) {\n          event = theTitle;\n        } else {\n          switch (type) {\n            case \"outbound\": {\n              event = hostname + (optionsLink.outboundFullUrl ? pathname : \"\");\n              break;\n            }\n            case \"download\": {\n              event = optionsLink.downloadsFullUrl\n                ? hostname + pathname\n                : pathname.split(\"/\").pop();\n              break;\n            }\n            case \"email\": {\n              var href = element.getAttribute(\"href\");\n              event = (href.split(\":\")[1] || \"\").split(\"?\")[0];\n              break;\n            }\n          }\n        }\n\n        var clean =\n          type +\n          \"_\" +\n          event.replace(/[^a-z0-9]+/gi, \"_\").replace(/(^_+|_+$)/g, \"\");\n\n        window[saGlobal](clean, callback);\n\n        log(\"collected \" + clean);\n\n        return window.setTimeout(callback, 5000);\n      } else {\n        log(saGlobal + \" is not defined\", \"warn\");\n        return callback();\n      }\n    } catch (error) {\n      log(error.message, \"warn\");\n    }\n  };\n\n  function onDOMContentLoaded() {\n    try {\n      var a = document.getElementsByTagName(\"a\");\n\n      // Loop over all links on the page\n      for (var i = 0; i < a.length; i++) {\n        var link = a[i];\n        var collect = false;\n\n        // We don't want to overwrite website behaviour so we check for the onclick attribute\n        if (!link.getAttribute(\"onclick\")) {\n          // Collect download clicks\n          if (\n            optionsLink.downloads &&\n            /^https?:\\/\\//i.test(link.href) &&\n            new RegExp(\n              \".(\" + (optionsLink.downloadsExtensions || []).join(\"|\") + \")\",\n              \"i\"\n            ).test(link.pathname)\n          ) {\n            collect = \"download\";\n\n            // Collect outbound links clicks\n          } else if (\n            optionsLink.outbound &&\n            /^https?:\\/\\//i.test(link.href) &&\n            link.hostname !== window.location.hostname\n          ) {\n            collect = \"outbound\";\n\n            // Collect email clicks\n          } else if (optionsLink.emails && /^mailto:/i.test(link.href)) {\n            collect = \"email\";\n          }\n\n          if (collect) {\n            var onClickAttribute = \"saAutomatedLink(this, '\" + collect + \"');\";\n\n            if (\n              !link.hasAttribute(\"target\") ||\n              link.getAttribute(\"target\") === \"_self\"\n            )\n              onClickAttribute += \" return false;\";\n\n            link.setAttribute(\"onclick\", onClickAttribute);\n          }\n        }\n      }\n    } catch (error) {\n      log(error.message, \"warn\");\n    }\n  }\n\n  if (doc.readyState === \"ready\" || doc.readyState === \"complete\") {\n    onDOMContentLoaded();\n  } else {\n    document.addEventListener(\"readystatechange\", function (event) {\n      if (event.target.readyState === \"complete\") onDOMContentLoaded();\n    });\n  }\n})(window);\n"],"names":["onDOMContentLoaded","a","document","getElementsByTagName","i","length","onClickAttribute","link","collect","getAttribute","optionsLink","downloads","test","href","RegExp","downloadsExtensions","join","pathname","outbound","hostname","window","location","emails","hasAttribute","setAttribute","error","log","message","doc","scriptElement","setting","collectTypes","fullUrls","options","saGlobal","type","logger","console","warn","info","currentScript","querySelector","attribute","defaultValue","value","dataset","split","map","item","trim","filter","Boolean","indexOf","title","outboundFullUrl","downloadsFullUrl","saAutomatedLink","element","sent","callback","theTitle","useTitle","event","pop","clean","replace","setTimeout","readyState","addEventListener","target"],"mappings":"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"}